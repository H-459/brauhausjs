/*
@preserve
Brauhaus.js Beer Calculator
Copyright 2013 Daniel G. Taylor <danielgtaylor@gmail.com>
https://github.com/danielgtaylor/brauhausjs
*/
(function(){var Brauhaus,DOMParser,tanh,_ref,__hasProp={}.hasOwnProperty,__extends=function(child,parent){for(var key in parent){if(__hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child};DOMParser=(_ref=typeof window!=="undefined"&&window!==null?window.DOMParser:void 0)!=null?_ref:require("xmldom").DOMParser;tanh=function(number){return(Math.exp(number)-Math.exp(-number))/(Math.exp(number)+Math.exp(-number))};Brauhaus=typeof exports!=="undefined"&&exports!==null&&exports||(this.Brauhaus={});Brauhaus.COLOR_NAMES=[[2,"pale straw"],[3,"straw"],[4,"pale gold"],[6,"deep gold"],[9,"pale amber"],[12,"medium amber"],[15,"deep amber"],[18,"amber brown"],[20,"brown"],[24,"ruby brown"],[30,"deep brown"],[40,"black"]];Brauhaus.STYLES={"Light Lager":{"Lite American Lager":{gu:[1.028,1.04],fg:[.998,1.008],srm:[2,3],ibu:[8,12],abv:[2.8,4.2]},"Standard American Lager":{gu:[1.04,1.05],fg:[1.004,1.01],srm:[2,4],ibu:[8,15],abv:[4.2,5.3]},"Premium American Lager":{gu:[1.046,1.056],fg:[1.008,1.012],srm:[2,6],ibu:[15,25],abv:[4.6,6]},"Munich Helles":{gu:[1.045,1.051],fg:[1.008,1.012],srm:[3,5],ibu:[16,22],abv:[4.7,5.4]},"Dortmunder Export":{gu:[1.048,1.056],fg:[1.01,1.015],srm:[4,6],ibu:[23,30],abv:[4.8,6]}},Pilsner:{"German Pilsner (Pils)":{gu:[1.044,1.05],fg:[1.008,1.013],srm:[2,5],ibu:[25,45],abv:[4.4,5.2]},"Bohemian Pilsener":{gu:[1.044,1.056],fg:[1.013,1.017],srm:[3.5,6],ibu:[35,45],abv:[4.2,5.4]},"Classic American Pilsner":{gu:[1.044,1.05],fg:[1.01,1.015],srm:[3,6],ibu:[25,40],abv:[4.5,6]}},"European Amber Lager":{"Vienna Lager":{gu:[1.046,1.052],fg:[1.01,1.014],srm:[10,16],ibu:[18,30],abv:[4.5,5.5]},Oktoberfest:{gu:[1.05,1.057],fg:[1.012,1.016],srm:[7,14],ibu:[20,28],abv:[4.8,5.7]}},"Dark Lager":{"Dark American Lager":{gu:[1.044,1.056],fg:[1.008,1.012],srm:[14,22],ibu:[8,20],abv:[4.2,6]},"Munich Dunkel":{gu:[1.048,1.056],fg:[1.01,1.016],srm:[14,28],ibu:[18,28],abv:[4.5,5.6]},Schwarzbier:{gu:[1.046,1.052],fg:[1.01,1.016],srm:[17,30],ibu:[22,32],abv:[4.4,5.4]}},Bock:{"Maibock / Helles Bock":{gu:[1.064,1.072],fg:[1.011,1.018],srm:[6,11],ibu:[23,35],abv:[6.3,7.4]},"Traditional Bock":{gu:[1.064,1.072],fg:[1.013,1.019],srm:[14,22],ibu:[20,27],abv:[6.3,7.2]},Doppelbock:{gu:[1.072,1.112],fg:[1.016,1.024],srm:[6,25],ibu:[16,26],abv:[7,10]},Eisbock:{gu:[1.078,1.12],fg:[1.02,1.035],srm:[18,30],ibu:[25,35],abv:[9,14]}},"Light Hybrid Beer":{"Cream Ale":{gu:[1.042,1.055],fg:[1.006,1.012],srm:[2.5,5],ibu:[15,20],abv:[4.2,5.6]},"Blonde Ale":{gu:[1.038,1.054],fg:[1.008,1.013],srm:[3,6],ibu:[15,28],abv:[3.8,5.5]},"Kölsch":{gu:[1.044,1.05],fg:[1.007,1.011],srm:[3.5,5],ibu:[20,30],abv:[4.4,5.2]},"American Wheat or Rye Beer":{gu:[1.04,1.055],fg:[1.008,1.013],srm:[3,6],ibu:[15,30],abv:[4,5.5]}},"Amber Hybrid Beer":{"Northern German Altbier":{gu:[1.046,1.054],fg:[1.01,1.015],srm:[13,19],ibu:[25,40],abv:[4.5,5.2]},"California Common Beer":{gu:[1.048,1.054],fg:[1.011,1.014],srm:[10,14],ibu:[30,45],abv:[4.5,5.5]},"Düsseldorf Altbier":{gu:[1.046,1.054],fg:[1.01,1.015],srm:[11,17],ibu:[35,50],abv:[4.5,5.2]}},"English Pale Ale":{"Standard / Ordinary Bitter":{gu:[1.032,1.04],fg:[1.007,1.011],srm:[4,14],ibu:[25,35],abv:[3.2,3.8]},"Special / Best / Premium Bitter":{gu:[1.04,1.048],fg:[1.008,1.012],srm:[5,16],ibu:[25,40],abv:[3.8,4.6]},"Extra Special / Strong Bitter":{gu:[1.048,1.06],fg:[1.01,1.016],srm:[6,18],ibu:[30,50],abv:[4.6,6.2]}},"Scottish and Irish Ale":{"Scottish Light 60/-":{gu:[1.03,1.035],fg:[1.01,1.013],srm:[9,17],ibu:[10,20],abv:[2.5,3.2]},"Scottish Heavy 70/-":{gu:[1.035,1.04],fg:[1.01,1.015],srm:[9,17],ibu:[10,25],abv:[3.2,3.9]},"Scottish Export 80/-":{gu:[1.04,1.054],fg:[1.01,1.016],srm:[9,17],ibu:[15,30],abv:[3.9,5]},"Irish Red Ale":{gu:[1.044,1.05],fg:[1.01,1.014],srm:[9,18],ibu:[17,28],abv:[4,6]},"Strong Scotch Ale":{gu:[1.07,1.13],fg:[1.018,1.056],srm:[14,25],ibu:[17,35],abv:[6.5,10]}},"American Ale":{"American Pale Ale":{gu:[1.045,1.06],fg:[1.01,1.015],srm:[5,14],ibu:[30,45],abv:[4.5,6.2]},"American Amber Ale":{gu:[1.045,1.06],fg:[1.01,1.015],srm:[10,17],ibu:[25,40],abv:[4.5,6.2]},"American Brown Ale":{gu:[1.045,1.06],fg:[1.01,1.016],srm:[18,35],ibu:[20,40],abv:[4.3,6.2]}},"English Brown Ale":{Mild:{gu:[1.03,1.038],fg:[1.008,1.013],srm:[12,25],ibu:[10,25],abv:[2.8,4.5]},"Southern English Brown":{gu:[1.033,1.042],fg:[1.011,1.014],srm:[19,35],ibu:[12,20],abv:[2.8,4.1]},"Northern English Brown":{gu:[1.04,1.052],fg:[1.008,1.013],srm:[12,22],ibu:[20,30],abv:[4.2,5.4]}},Porter:{"Brown Porter":{gu:[1.04,1.052],fg:[1.008,1.014],srm:[20,30],ibu:[18,35],abv:[4,5.4]},"Robust Porter":{gu:[1.048,1.065],fg:[1.012,1.016],srm:[22,35],ibu:[25,50],abv:[4.8,6.5]},"Baltic Porter":{gu:[1.06,1.09],fg:[1.016,1.024],srm:[17,30],ibu:[20,40],abv:[5.5,9.5]}},Stout:{"Dry Stout":{gu:[1.036,1.05],fg:[1.007,1.011],srm:[25,40],ibu:[30,45],abv:[4,5]},"Sweet Stout":{gu:[1.044,1.06],fg:[1.012,1.024],srm:[30,40],ibu:[20,40],abv:[4,6]},"Oatmeal Stout":{gu:[1.048,1.065],fg:[1.01,1.018],srm:[22,40],ibu:[25,40],abv:[4.2,5.9]},"Foreign Extra Stout":{gu:[1.056,1.075],fg:[1.01,1.018],srm:[30,40],ibu:[30,70],abv:[5.5,8]},"American Stout":{gu:[1.05,1.075],fg:[1.01,1.022],srm:[30,40],ibu:[35,75],abv:[5,7]},"Russian Imperial Stout":{gu:[1.075,1.115],fg:[1.018,1.03],srm:[30,40],ibu:[50,90],abv:[8,12]}},"India Pale Ale":{"English IPA":{gu:[1.05,1.075],fg:[1.01,1.018],srm:[8,14],ibu:[40,60],abv:[5,7.5]},"American IPA":{gu:[1.056,10.75],fg:[1.01,1.018],srm:[6,15],ibu:[40,70],abv:[5.5,7.5]},"Imperial IPA":{gu:[1.07,1.09],fg:[1.01,1.02],srm:[8,15],ibu:[60,120],abv:[7.5,10]}},"German Wheat and Rye Beer":{"Weizen / Weissbier":{gu:[1.044,1.052],fg:[1.01,1.014],srm:[2,8],ibu:[8,15],abv:[4.3,5.6]},Dunkelweizen:{gu:[1.044,1.056],fg:[1.01,1.014],srm:[14,23],ibu:[10,18],abv:[4.3,5.6]},Weizenbock:{gu:[1.064,1.09],fg:[1.015,1.022],srm:[12,25],ibu:[15,30],abv:[6.5,8]},"Roggenbier (German Rye Beer)":{gu:[1.046,1.056],fg:[1.01,1.014],srm:[14,19],ibu:[10,20],abv:[4.5,6]}},"Belgian and French Ale":{Witbier:{gu:[1.044,1.052],fg:[1.008,1.012],srm:[2,4],ibu:[10,20],abv:[4.5,5.5]},"Belgian Pale Ale":{gu:[1.048,1.054],fg:[1.01,1.014],srm:[8,14],ibu:[20,30],abv:[4.8,5.5]},Saison:{gu:[1.048,1.065],fg:[1.002,1.012],srm:[5,14],ibu:[20,35],abv:[5,7]},"Bière de Garde":{gu:[1.06,1.08],fg:[1.008,1.016],srm:[6,19],ibu:[18,28],abv:[6,8.5]},"Belgian Specialty Ale":{gu:[1,1.12],fg:[1,1.06],srm:[2,40],ibu:[0,120],abv:[0,14]}},"Sour Ale":{"Berliner Weisse":{gu:[1.028,1.032],fg:[1.003,1.006],srm:[2,3],ibu:[3,8],abv:[2.8,3.8]},"Flanders Red Ale":{gu:[1.048,1.057],fg:[1.002,1.012],srm:[10,16],ibu:[10,25],abv:[4.6,6.5]},"Flanders Brown Ale / Oud Bruin":{gu:[1.04,1.074],fg:[1.008,1.012],srm:[15,22],ibu:[20,25],abv:[4,8]},"Straight (Unblended) Lambic":{gu:[1.04,1.054],fg:[1.001,1.01],srm:[3,7],ibu:[0,10],abv:[5,6.5]},Gueuze:{gu:[1.04,1.06],fg:[1,1.006],srm:[3,7],ibu:[0,10],abv:[5,8]},"Fruit Lambic":{gu:[1.04,1.06],fg:[1,1.01],srm:[3,7],ibu:[0,10],abv:[5,7]}},"Belgian Strong Ale":{"Belgian Blond Ale":{gu:[1.062,1.075],fg:[1.008,1.018],srm:[4,7],ibu:[15,30],abv:[6,7.5]},"Belgian Dubbel":{gu:[1.062,1.075],fg:[1.008,1.018],srm:[10,17],ibu:[15,25],abv:[6,7.6]},"Belgian Tripel":{gu:[1.075,1.085],fg:[1.008,1.014],srm:[4.5,7],ibu:[20,40],abv:[7.5,9.5]},"Belgian Golden Strong Ale":{gu:[1.07,1.095],fg:[1.005,1.016],srm:[3,6],ibu:[22,35],abv:[7.5,10.5]},"Belgian Dark Strong Ale":{gu:[1.075,1.11],fg:[1.01,1.024],srm:[12,22],ibu:[20,35],abv:[8,11]}},"Strong Ale":{"Old Ale":{gu:[1.06,1.09],fg:[1.015,1.022],srm:[10,22],ibu:[30,60],abv:[6,9]},"English Barleywine":{gu:[1.08,1.12],fg:[1.018,1.03],srm:[8,22],ibu:[35,70],abv:[8,12]},"American Barleywine":{gu:[1.08,1.12],fg:[1.016,1.03],srm:[10,19],ibu:[50,120],abv:[8,12]}},"Fruit Beer":{"Fruit Beer":{gu:[1,1.12],fg:[1,1.16],srm:[1,40],ibu:[0,120],abv:[0,14]}},"Spice / Herb / Vegetable Beer":{"Spice, Herb, or Vegetable Beer":{gu:[1,1.12],fg:[1,1.16],srm:[1,40],ibu:[0,120],abv:[0,14]},"Christmas / Winter Specialty Spiced Beer":{gu:[1,1.12],fg:[1,1.16],srm:[8,40],ibu:[0,120],abv:[6,14]}},"Smoke-Flavored and Wood-Aged Beer":{"Classic Rauchbier":{gu:[1.05,1.056],fg:[1.012,1.016],srm:[14,22],ibu:[20,30],abv:[4.8,6]},"Other Smoked Beer":{gu:[1,1.12],fg:[1,1.16],srm:[1,40],ibu:[0,120],abv:[0,14]},"Wood-Aged Beer":{gu:[1,1.12],fg:[1,1.16],srm:[1,40],ibu:[0,120],abv:[0,14]}},"Specialty Beer":{"Specialty Beer":{gu:[1,1.12],fg:[1,1.16],srm:[1,40],ibu:[0,120],abv:[0,14]}}};Brauhaus.getStyleCategories=function(){var categories,key,value,_ref1;categories=[];_ref1=Brauhaus.STYLES;for(key in _ref1){if(!__hasProp.call(_ref1,key))continue;value=_ref1[key];categories.push(key)}return categories};Brauhaus.getStyles=function(category){var key,styles,value,_ref1;styles=[];_ref1=Brauhaus.STYLES[category];for(key in _ref1){if(!__hasProp.call(_ref1,key))continue;value=_ref1[key];styles.push(key)}return styles};Brauhaus.getStyle=function(category,name){return Brauhaus.STYLES[category][name]};Brauhaus.kgToLb=function(kg){return kg*2.20462};Brauhaus.lbToKg=function(lb){return lb/2.20462};Brauhaus.kgToLbOz=function(kg){var lb;lb=Brauhaus.kgToLb(kg);return{lb:Math.floor(lb),oz:(lb-Math.floor(lb))*16}};Brauhaus.lbOzToKg=function(lb,oz){return Brauhaus.lbToKg(lb+oz/16)};Brauhaus.litersToGallons=function(liters){return liters*.264172};Brauhaus.gallonsToLiters=function(gallons){return gallons/.264172};Brauhaus.cToF=function(celcius){return celcius*1.8+32};Brauhaus.fToC=function(fahrenheit){return(fahrenheit-32)/1.8};Brauhaus.srmToRgb=function(srm){var b,g,r;r=Math.round(Math.min(255,Math.max(0,255*Math.pow(.975,srm))));g=Math.round(Math.min(255,Math.max(0,245*Math.pow(.88,srm))));b=Math.round(Math.min(255,Math.max(0,220*Math.pow(.7,srm))));return[r,g,b]};Brauhaus.srmToCss=function(srm){var b,g,r,_ref1;_ref1=Brauhaus.srmToRgb(srm),r=_ref1[0],g=_ref1[1],b=_ref1[2];return"rgb("+r+", "+g+", "+b+")"};Brauhaus.srmToName=function(srm){var color,item,_i,_len,_ref1;color=Brauhaus.COLOR_NAMES[0][1];_ref1=Brauhaus.COLOR_NAMES;for(_i=0,_len=_ref1.length;_i<_len;_i++){item=_ref1[_i];if(item[0]<=srm){color=item[1]}}return color};Brauhaus.OptionConstructor=function(){function OptionConstructor(options){var property;for(property in options){if(!__hasProp.call(options,property))continue;this[property]=options[property]}}return OptionConstructor}();Brauhaus.Ingredient=function(_super){__extends(Ingredient,_super);function Ingredient(options){this.name="New "+this.constructor.name;Ingredient.__super__.constructor.call(this,options)}Ingredient.prototype.nameRegex=function(regex){var item,result,_i,_len;result=false;if(typeof regex==="string"){result=regex.exec(this.name)}else{for(_i=0,_len=regex.length;_i<_len;_i++){item=regex[_i];if(Array.isArray(item)&&item.length===2){if(item[0].exec(this.name)){result=item[1];break}}else if(typeof item==="string"){result=item.exec(this.name)}else{throw"Invalid regex input!"}}}return result};return Ingredient}(Brauhaus.OptionConstructor);Brauhaus.Fermentable=function(_super){__extends(Fermentable,_super);function Fermentable(){return Fermentable.__super__.constructor.apply(this,arguments)}Fermentable.STEEP=/biscuit|black|cara|chocolate|crystal|munich|roast|special ?b|toast|victory|vienna/i;Fermentable.BOIL=/candi|candy|dme|dry|extract|honey|lme|liquid|sugar|syrup|turbinado/i;Fermentable.prototype.weight=1;Fermentable.prototype["yield"]=75;Fermentable.prototype.color=2;Fermentable.prototype.late=false;Fermentable.prototype.type=function(){return this.nameRegex([[Brauhaus.Fermentable.BOIL,"extract"],[/.*/,"grain"]])};Fermentable.prototype.addition=function(){return this.nameRegex([[/mash/i,"mash"],[/steep/i,"steep"],[/boil/i,"boil"],[Brauhaus.Fermentable.BOIL,"boil"],[Brauhaus.Fermentable.STEEP,"steep"],[/.*/,"mash"]])};Fermentable.prototype.weightLb=function(){return Brauhaus.kgToLb(this.weight)};Fermentable.prototype.weightLbOz=function(){return Brauhaus.kgToLbOz(this.weight)};Fermentable.prototype.ppg=function(){return this["yield"]*.46214};Fermentable.prototype.plato=function(liters){if(liters==null){liters=1}return 259-259/(1+this.gu(liters)/1e3)};Fermentable.prototype.gu=function(liters){if(liters==null){liters=1}return this.ppg()*this.weightLb()/Brauhaus.litersToGallons(liters)};Fermentable.prototype.colorRgb=function(){return Brauhaus.srmToRgb(this.color)};Fermentable.prototype.colorCss=function(){return Brauhaus.srmToCss(this.color)};Fermentable.prototype.colorName=function(){return Brauhaus.srmToName(this.color)};Fermentable.prototype.price=function(){var pricePerKg;pricePerKg=this.nameRegex([[/dry|dme/i,8.8],[/liquid|lme/i,6.6],[/.*/i,4.4]]);return this.weight*pricePerKg};return Fermentable}(Brauhaus.Ingredient);Brauhaus.Spice=function(_super){__extends(Spice,_super);function Spice(){return Spice.__super__.constructor.apply(this,arguments)}Spice.prototype.weight=.025;Spice.prototype.aa=0;Spice.prototype.use="boil";Spice.prototype.time=60;Spice.prototype.form="pellet";Spice.prototype.weightLb=function(){return Brauhaus.kgToLb(this.weight)};Spice.prototype.weightLbOz=function(){return Brauhaus.kgToLbOz(this.weight)};Spice.prototype.price=function(){var pricePerKg;pricePerKg=this.nameRegex([[/.*/i,17.64]]);return this.weight*pricePerKg};return Spice}(Brauhaus.Ingredient);Brauhaus.Yeast=function(_super){__extends(Yeast,_super);function Yeast(){return Yeast.__super__.constructor.apply(this,arguments)}Yeast.prototype.type="ale";Yeast.prototype.form="liquid";Yeast.prototype.attenuation=75;Yeast.prototype.price=function(){return this.nameRegex([[/wyeast|white labs|wlp/i,7],[/.*/i,3.5]])};return Yeast}(Brauhaus.Ingredient);Brauhaus.Recipe=function(_super){var style;__extends(Recipe,_super);Recipe.prototype.name="New Recipe";Recipe.prototype.description="Recipe description";Recipe.prototype.author="Anonymous Brewer";Recipe.prototype.boilSize=10;Recipe.prototype.batchSize=20;Recipe.prototype.servingSize=.355;Recipe.prototype.steepEfficiency=50;Recipe.prototype.mashEfficiency=75;style=null;Recipe.prototype.ibuMethod="tinseth";Recipe.prototype.fermentables=null;Recipe.prototype.spices=null;Recipe.prototype.yeast=null;Recipe.prototype.og=0;Recipe.prototype.fg=0;Recipe.prototype.color=0;Recipe.prototype.ibu=0;Recipe.prototype.abv=0;Recipe.prototype.price=0;Recipe.prototype.ogPlato=0;Recipe.prototype.fgPlato=0;Recipe.prototype.abw=0;Recipe.prototype.realExtract=0;Recipe.prototype.calories=0;Recipe.fromBeerXml=function(xml){var doc,fermentable,fermentableNode,fermentableProperty,parser,recipe,recipeNode,recipeProperty,recipes,spice,spiceNode,spiceProperty,yeast,yeastNode,yeastProperty,_i,_j,_k,_l,_len,_len1,_len2,_len3,_len4,_len5,_len6,_len7,_m,_n,_o,_p,_ref1,_ref2,_ref3,_ref4,_ref5,_ref6,_ref7,_ref8,_ref9;recipes=[];parser=new DOMParser;doc=parser.parseFromString(xml,"text/xml");_ref1=doc.documentElement.childNodes||[];for(_i=0,_len=_ref1.length;_i<_len;_i++){recipeNode=_ref1[_i];if(recipeNode.nodeName.toLowerCase()!=="recipe"){continue}recipe=new Brauhaus.Recipe;_ref2=recipeNode.childNodes||[];for(_j=0,_len1=_ref2.length;_j<_len1;_j++){recipeProperty=_ref2[_j];switch(recipeProperty.nodeName.toLowerCase()){case"name":recipe.name=recipeProperty.textContent;break;case"brewer":recipe.author=recipeProperty.textContent;break;case"batch_size":recipe.batchSize=parseFloat(recipeProperty.textContent);break;case"boil_size":recipe.boilSize=parseFloat(recipeProperty.textContent);break;case"efficiency":recipe.mashEfficiency=parseFloat(recipeProperty.textContent);break;case"fermentables":_ref3=recipeProperty.childNodes||[];for(_k=0,_len2=_ref3.length;_k<_len2;_k++){fermentableNode=_ref3[_k];if(fermentableNode.nodeName.toLowerCase()!=="fermentable"){continue}fermentable=new Brauhaus.Fermentable;_ref4=fermentableNode.childNodes||[];for(_l=0,_len3=_ref4.length;_l<_len3;_l++){fermentableProperty=_ref4[_l];switch(fermentableProperty.nodeName.toLowerCase()){case"name":fermentable.name=fermentableProperty.textContent;break;case"amount":fermentable.weight=parseFloat(fermentableProperty.textContent);break;case"yield":fermentable["yield"]=parseFloat(fermentableProperty.textContent);break;case"color":fermentable.color=parseFloat(fermentableProperty.textContent);break;case"add_after_boil":fermentable.late=fermentableProperty.textContent.toLowerCase()==="true"}}recipe.fermentables.push(fermentable)}break;case"hops":case"miscs":_ref5=recipeProperty.childNodes||[];for(_m=0,_len4=_ref5.length;_m<_len4;_m++){spiceNode=_ref5[_m];if((_ref6=spiceNode.nodeName.toLowerCase())!=="hop"&&_ref6!=="misc"){continue}spice=new Brauhaus.Spice;_ref7=spiceNode.childNodes||[];for(_n=0,_len5=_ref7.length;_n<_len5;_n++){spiceProperty=_ref7[_n];switch(spiceProperty.nodeName.toLowerCase()){case"name":spice.name=spiceProperty.textContent;break;case"amount":spice.weight=parseFloat(spiceProperty.textContent);break;case"alpha":spice.aa=parseFloat(spiceProperty.textContent);break;case"use":spice.use=spiceProperty.textContent;break;case"form":spice.form=spiceProperty.textContent}}recipe.spices.push(spice)}break;case"yeasts":_ref8=recipeProperty.childNodes||[];for(_o=0,_len6=_ref8.length;_o<_len6;_o++){yeastNode=_ref8[_o];if(yeastNode.nodeName.toLowerCase()!=="yeast"){continue}yeast=new Brauhaus.Yeast;_ref9=yeastNode.childNodes||[];for(_p=0,_len7=_ref9.length;_p<_len7;_p++){yeastProperty=_ref9[_p];switch(yeastProperty.nodeName.toLowerCase()){case"name":yeast.name=yeastProperty.textContent;break;case"type":yeast.type=yeastProperty.textContent;break;case"form":yeast.form=yeastProperty.textContent;break;case"attenuation":yeast.attenuation=parseFloat(yeastProperty.textContent)}}recipe.yeast.push(yeast)}}}recipes.push(recipe)}return recipes};function Recipe(options){this.fermentables=[];this.spices=[];this.yeast=[];Recipe.__super__.constructor.call(this,options)}Recipe.prototype.batchSizeGallons=function(){return Brauhaus.litersToGallons(this.batchSize)};Recipe.prototype.boilSizeGallons=function(){return Brauhaus.litersToGallons(this.boilSize)};Recipe.prototype.add=function(type,values){if(type==="fermentable"){return this.fermentables.push(new Brauhaus.Fermentable(values))}else if(type==="spice"){return this.spices.push(new Brauhaus.Spice(values))}else if(type==="yeast"){return this.yeast.push(new Brauhaus.Yeast(values))}};Recipe.prototype.calculate=function(){var addition,adjustment,attenuation,bitterness,earlyOg,efficiency,fermentable,gravity,mcu,spice,utilization,utilizationFactor,yeast,_i,_j,_k,_len,_len1,_len2,_ref1,_ref2,_ref3,_results;this.og=1;this.fg=0;this.ibu=0;this.price=0;earlyOg=1;mcu=0;attenuation=0;_ref1=this.fermentables;for(_i=0,_len=_ref1.length;_i<_len;_i++){fermentable=_ref1[_i];efficiency=1;addition=fermentable.addition();if(addition==="steep"){efficiency=this.steepEfficiency/100}else if(addition==="mash"){efficiency=this.mashEfficiency/100}mcu+=fermentable.color*fermentable.weightLb()/this.batchSizeGallons();gravity=fermentable.gu(this.batchSize)*efficiency/1e3;this.og+=gravity;if(!fermentable.late){earlyOg+=gravity}this.price+=fermentable.price()}this.color=1.4922*Math.pow(mcu,.6859);_ref2=this.yeast;for(_j=0,_len1=_ref2.length;_j<_len1;_j++){yeast=_ref2[_j];if(yeast.attenuation>attenuation){attenuation=yeast.attenuation}this.price+=yeast.price()}if(attenuation===0){attenuation=75}this.fg=this.og-(this.og-1)*attenuation/100;this.abv=1.05*(this.og-this.fg)/this.fg/.79*100;this.ogPlato=-463.37+668.72*this.og-205.35*this.og*this.og;this.fgPlato=-463.37+668.72*this.fg-205.35*this.fg*this.fg;this.realExtract=.1808*this.ogPlato+.8192*this.fgPlato;this.abw=.79*this.abv/this.fg;this.calories=Math.max(0,(6.9*this.abw+4*(this.realExtract-.1))*this.fg*this.servingSize*10);_ref3=this.spices;_results=[];for(_k=0,_len2=_ref3.length;_k<_len2;_k++){spice=_ref3[_k];bitterness=0;if(spice.aa&&spice.use==="boil"){utilizationFactor=1;if(spice.form==="pellet"){utilizationFactor=1.15}if(this.ibuMethod==="tinseth"){bitterness=1.65*Math.pow(125e-6,earlyOg-1)*((1-Math.pow(Math.E,-.04*spice.time))/4.15)*(spice.aa/100*spice.weight*1e6/this.batchSize)*utilizationFactor;this.ibu+=bitterness}else if(this.ibuMethod==="rager"){utilization=18.11+13.86*tanh((spice.time-31.32)/18.27);adjustment=Math.max(0,(earlyOg-1.05)/.2);bitterness=spice.weight*100*utilization*utilizationFactor*spice.aa/(this.batchSize*(1+adjustment));this.ibu+=bitterness}else{throw"Unknown IBU method '"+this.ibuMethod+"'!"}}_results.push(this.price+=spice.price())}return _results};Recipe.prototype.toBeerXml=function(){var fermentable,hop,misc,xml,yeast,_i,_j,_k,_l,_len,_len1,_len2,_len3,_ref1,_ref2,_ref3,_ref4;xml='<?xml version="1.0" encoding="utf-8"?><recipes><recipe>';xml+="<version>1</version>";xml+="<name>"+this.name+"</name>";xml+="<brewer>"+this.author+"</brewer>";xml+="<batch_size>"+this.batchSize+"</batch_size>";xml+="<boil_size>"+this.boilSize+"</boil_size>";xml+="<efficiency>"+this.mashEfficiency+"</efficiency>";xml+="<fermentables>";_ref1=this.fermentables;for(_i=0,_len=_ref1.length;_i<_len;_i++){fermentable=_ref1[_i];xml+="<fermentable><version>1</version>";xml+="<name>"+fermentable.name+"</name>";xml+="<type>"+fermentable.type()+"</name>";xml+="<weight>"+fermentable.weight.toFixed(1)+"</weight>";xml+="<yield>"+fermentable["yield"].toFixed(1)+"</yield>";xml+="<color>"+fermentable.color.toFixed(1)+"</color>";xml+="</fermentable>"}xml+="</fermentables>";xml+="<hops>";_ref2=this.spices.filter(function(item){return item.aa>0});for(_j=0,_len1=_ref2.length;_j<_len1;_j++){hop=_ref2[_j];xml+="<hop>";xml+="<name>"+hop.name+"</name>";xml+="<time>"+hop.time+"</time>";xml+="<amount>"+hop.weight+"</amount>";xml+="<alpha>"+hop.aa.toFixed(2)+"</alpha>";xml+="<use>"+hop.use+"</use>";xml+="<form>"+hop.form+"</form>";xml+="</hop>"}xml+="</hops>";xml+="<yeasts>";_ref3=this.yeast;for(_k=0,_len2=_ref3.length;_k<_len2;_k++){yeast=_ref3[_k];xml+="<yeast>";xml+="<name>"+yeast.name+"</name>";xml+="<type>"+yeast.type+"</type>";xml+="<form>"+yeast.form+"</form>";xml+="<attenuation>"+yeast.attenuation+"</attenuation>";xml+="</yeast>"}xml+="</yeasts>";xml+="<miscs>";_ref4=this.spices.filter(function(item){return item.aa===0});for(_l=0,_len3=_ref4.length;_l<_len3;_l++){misc=_ref4[_l];xml+="<misc>";xml+="<name>"+misc.name+"</name>";xml+="<time>"+misc.time+"</time>";xml+="<amount>"+misc.weight+"</amount>";xml+="<use>"+misc.use+"</use>";xml+="</misc>"}xml+="</miscs>";return xml+="</recipe></recipes>"};return Recipe}(Brauhaus.OptionConstructor)}).call(this);