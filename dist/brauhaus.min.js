/*
@preserve
Brauhaus.js Beer Calculator
Copyright 2013 Daniel G. Taylor <danielgtaylor@gmail.com>
https://github.com/danielgtaylor/brauhausjs
*/
(function(){var Brauhaus,DOMParser,categoryName,categoryStyles,style,styleName,tanh,_ref,_ref1,_ref2,_ref3,_ref4,_ref5,__hasProp={}.hasOwnProperty,__extends=function(child,parent){for(var key in parent){if(__hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child},__indexOf=[].indexOf||function(item){for(var i=0,l=this.length;i<l;i++){if(i in this&&this[i]===item)return i}return-1};DOMParser=(_ref=typeof window!=="undefined"&&window!==null?window.DOMParser:void 0)!=null?_ref:require("xmldom").DOMParser;tanh=function(number){return(Math.exp(number)-Math.exp(-number))/(Math.exp(number)+Math.exp(-number))};Brauhaus=typeof exports!=="undefined"&&exports!==null&&exports||(this.Brauhaus={});Brauhaus.ROOM_TEMP=23;Brauhaus.BURNER_ENERGY=9e3;Brauhaus.MASH_HEAT_LOSS=5;Brauhaus.COLOR_NAMES=[[2,"pale straw"],[3,"straw"],[4,"yellow"],[6,"gold"],[9,"amber"],[14,"deep amber"],[17,"copper"],[18,"deep copper"],[22,"brown"],[30,"dark brown"],[35,"very dark brown"],[40,"black"]];Brauhaus.STYLES={"Light Lager":{"Lite American Lager":{gu:[1.028,1.04],fg:[.998,1.008],srm:[2,3],ibu:[8,12],abv:[2.8,4.2],carb:[2.5,2.8]},"Standard American Lager":{gu:[1.04,1.05],fg:[1.004,1.01],srm:[2,4],ibu:[8,15],abv:[4.2,5.3],carb:[2.5,2.8]},"Premium American Lager":{gu:[1.046,1.056],fg:[1.008,1.012],srm:[2,6],ibu:[15,25],abv:[4.6,6],carb:[2.5,2.8]},"Munich Helles":{gu:[1.045,1.051],fg:[1.008,1.012],srm:[3,5],ibu:[16,22],abv:[4.7,5.4],carb:[2.3,2.7]},"Dortmunder Export":{gu:[1.048,1.056],fg:[1.01,1.015],srm:[4,6],ibu:[23,30],abv:[4.8,6],carb:[2.4,2.7]}},Pilsner:{"German Pilsner (Pils)":{gu:[1.044,1.05],fg:[1.008,1.013],srm:[2,5],ibu:[25,45],abv:[4.4,5.2],carb:[2.4,2.7]},"Bohemian Pilsener":{gu:[1.044,1.056],fg:[1.013,1.017],srm:[3.5,6],ibu:[35,45],abv:[4.2,5.4],carb:[2.3,2.6]},"Classic American Pilsner":{gu:[1.044,1.05],fg:[1.01,1.015],srm:[3,6],ibu:[25,40],abv:[4.5,6],carb:[2.5,2.7]}},"European Amber Lager":{"Vienna Lager":{gu:[1.046,1.052],fg:[1.01,1.014],srm:[10,16],ibu:[18,30],abv:[4.5,5.5],carb:[2.4,2.6]},Oktoberfest:{gu:[1.05,1.057],fg:[1.012,1.016],srm:[7,14],ibu:[20,28],abv:[4.8,5.7],carb:[2.5,2.8]}},"Dark Lager":{"Dark American Lager":{gu:[1.044,1.056],fg:[1.008,1.012],srm:[14,22],ibu:[8,20],abv:[4.2,6],carb:[2.5,2.9]},"Munich Dunkel":{gu:[1.048,1.056],fg:[1.01,1.016],srm:[14,28],ibu:[18,28],abv:[4.5,5.6],carb:[2.2,2.7]},Schwarzbier:{gu:[1.046,1.052],fg:[1.01,1.016],srm:[17,30],ibu:[22,32],abv:[4.4,5.4],carb:[2.2,2.7]}},Bock:{"Maibock / Helles Bock":{gu:[1.064,1.072],fg:[1.011,1.018],srm:[6,11],ibu:[23,35],abv:[6.3,7.4],carb:[2.2,2.7]},"Traditional Bock":{gu:[1.064,1.072],fg:[1.013,1.019],srm:[14,22],ibu:[20,27],abv:[6.3,7.2],carb:[2.2,2.7]},Doppelbock:{gu:[1.072,1.112],fg:[1.016,1.024],srm:[6,25],ibu:[16,26],abv:[7,10],carb:[2.3,2.6]},Eisbock:{gu:[1.078,1.12],fg:[1.02,1.035],srm:[18,30],ibu:[25,35],abv:[9,14],carb:[2.2,2.6]}},"Light Hybrid Beer":{"Cream Ale":{gu:[1.042,1.055],fg:[1.006,1.012],srm:[2.5,5],ibu:[15,20],abv:[4.2,5.6],carb:[2.4,2.8]},"Blonde Ale":{gu:[1.038,1.054],fg:[1.008,1.013],srm:[3,6],ibu:[15,28],abv:[3.8,5.5],carb:[2.4,2.8]},"Kölsch":{gu:[1.044,1.05],fg:[1.007,1.011],srm:[3.5,5],ibu:[20,30],abv:[4.4,5.2],carb:[2.4,2.8]},"American Wheat or Rye Beer":{gu:[1.04,1.055],fg:[1.008,1.013],srm:[3,6],ibu:[15,30],abv:[4,5.5],carb:[2.5,2.9]}},"Amber Hybrid Beer":{"Northern German Altbier":{gu:[1.046,1.054],fg:[1.01,1.015],srm:[13,19],ibu:[25,40],abv:[4.5,5.2],carb:[2.2,2.7]},"California Common Beer":{gu:[1.048,1.054],fg:[1.011,1.014],srm:[10,14],ibu:[30,45],abv:[4.5,5.5],carb:[2.3,2.8]},"Düsseldorf Altbier":{gu:[1.046,1.054],fg:[1.01,1.015],srm:[11,17],ibu:[35,50],abv:[4.5,5.2],carb:[2.1,3.1]}},"English Pale Ale":{"Standard / Ordinary Bitter":{gu:[1.032,1.04],fg:[1.007,1.011],srm:[4,14],ibu:[25,35],abv:[3.2,3.8],carb:[.8,2.2]},"Special / Best / Premium Bitter":{gu:[1.04,1.048],fg:[1.008,1.012],srm:[5,16],ibu:[25,40],abv:[3.8,4.6],carb:[.8,2.1]},"Extra Special / Strong Bitter":{gu:[1.048,1.06],fg:[1.01,1.016],srm:[6,18],ibu:[30,50],abv:[4.6,6.2],carb:[1.5,2.4]}},"Scottish and Irish Ale":{"Scottish Light 60/-":{gu:[1.03,1.035],fg:[1.01,1.013],srm:[9,17],ibu:[10,20],abv:[2.5,3.2],carb:[1.5,2.3]},"Scottish Heavy 70/-":{gu:[1.035,1.04],fg:[1.01,1.015],srm:[9,17],ibu:[10,25],abv:[3.2,3.9],carb:[1.5,2.3]},"Scottish Export 80/-":{gu:[1.04,1.054],fg:[1.01,1.016],srm:[9,17],ibu:[15,30],abv:[3.9,5],carb:[1.5,2.3]},"Irish Red Ale":{gu:[1.044,1.05],fg:[1.01,1.014],srm:[9,18],ibu:[17,28],abv:[4,6],carb:[2.1,2.6]},"Strong Scotch Ale":{gu:[1.07,1.13],fg:[1.018,1.056],srm:[14,25],ibu:[17,35],abv:[6.5,10],carb:[1.6,2.4]}},"American Ale":{"American Pale Ale":{gu:[1.045,1.06],fg:[1.01,1.015],srm:[5,14],ibu:[30,45],abv:[4.5,6.2],carb:[2.3,2.8]},"American Amber Ale":{gu:[1.045,1.06],fg:[1.01,1.015],srm:[10,17],ibu:[25,40],abv:[4.5,6.2],carb:[2.3,2.8]},"American Brown Ale":{gu:[1.045,1.06],fg:[1.01,1.016],srm:[18,35],ibu:[20,40],abv:[4.3,6.2],carb:[2,2.6]}},"English Brown Ale":{Mild:{gu:[1.03,1.038],fg:[1.008,1.013],srm:[12,25],ibu:[10,25],abv:[2.8,4.5],carb:[1.3,2.3]},"Southern English Brown":{gu:[1.033,1.042],fg:[1.011,1.014],srm:[19,35],ibu:[12,20],abv:[2.8,4.1],carb:[1.3,2.3]},"Northern English Brown":{gu:[1.04,1.052],fg:[1.008,1.013],srm:[12,22],ibu:[20,30],abv:[4.2,5.4],carb:[2.2,2.7]}},Porter:{"Brown Porter":{gu:[1.04,1.052],fg:[1.008,1.014],srm:[20,30],ibu:[18,35],abv:[4,5.4],carb:[1.8,2.5]},"Robust Porter":{gu:[1.048,1.065],fg:[1.012,1.016],srm:[22,35],ibu:[25,50],abv:[4.8,6.5],carb:[1.8,2.5]},"Baltic Porter":{gu:[1.06,1.09],fg:[1.016,1.024],srm:[17,30],ibu:[20,40],abv:[5.5,9.5],carb:[1.8,2.5]}},Stout:{"Dry Stout":{gu:[1.036,1.05],fg:[1.007,1.011],srm:[25,40],ibu:[30,45],abv:[4,5],carb:[1.8,2.5]},"Sweet Stout":{gu:[1.044,1.06],fg:[1.012,1.024],srm:[30,40],ibu:[20,40],abv:[4,6],carb:[2,2.4]},"Oatmeal Stout":{gu:[1.048,1.065],fg:[1.01,1.018],srm:[22,40],ibu:[25,40],abv:[4.2,5.9],carb:[1.9,2.5]},"Foreign Extra Stout":{gu:[1.056,1.075],fg:[1.01,1.018],srm:[30,40],ibu:[30,70],abv:[5.5,8],carb:[2,2.6]},"American Stout":{gu:[1.05,1.075],fg:[1.01,1.022],srm:[30,40],ibu:[35,75],abv:[5,7],carb:[2.3,2.9]},"Russian Imperial Stout":{gu:[1.075,1.115],fg:[1.018,1.03],srm:[30,40],ibu:[50,90],abv:[8,12],carb:[1.8,2.6]}},"India Pale Ale":{"English IPA":{gu:[1.05,1.075],fg:[1.01,1.018],srm:[8,14],ibu:[40,60],abv:[5,7.5],carb:[2.2,2.7]},"American IPA":{gu:[1.056,10.75],fg:[1.01,1.018],srm:[6,15],ibu:[40,70],abv:[5.5,7.5],carb:[2.2,2.7]},"Imperial IPA":{gu:[1.07,1.09],fg:[1.01,1.02],srm:[8,15],ibu:[60,120],abv:[7.5,10],carb:[2.2,2.7]}},"German Wheat and Rye Beer":{"Weizen / Weissbier":{gu:[1.044,1.052],fg:[1.01,1.014],srm:[2,8],ibu:[8,15],abv:[4.3,5.6],carb:[2.4,2.9]},Dunkelweizen:{gu:[1.044,1.056],fg:[1.01,1.014],srm:[14,23],ibu:[10,18],abv:[4.3,5.6],carb:[2.5,2.9]},Weizenbock:{gu:[1.064,1.09],fg:[1.015,1.022],srm:[12,25],ibu:[15,30],abv:[6.5,8],carb:[2.4,2.9]},"Roggenbier (German Rye Beer)":{gu:[1.046,1.056],fg:[1.01,1.014],srm:[14,19],ibu:[10,20],abv:[4.5,6],carb:[2.5,2.9]}},"Belgian and French Ale":{Witbier:{gu:[1.044,1.052],fg:[1.008,1.012],srm:[2,4],ibu:[10,20],abv:[4.5,5.5],carb:[2.1,2.9]},"Belgian Pale Ale":{gu:[1.048,1.054],fg:[1.01,1.014],srm:[8,14],ibu:[20,30],abv:[4.8,5.5],carb:[2.1,2.7]},Saison:{gu:[1.048,1.065],fg:[1.002,1.012],srm:[5,14],ibu:[20,35],abv:[5,7],carb:[2.3,2.9]},"Bière de Garde":{gu:[1.06,1.08],fg:[1.008,1.016],srm:[6,19],ibu:[18,28],abv:[6,8.5],carb:[2.3,2.9]},"Belgian Specialty Ale":{gu:[1,1.12],fg:[1,1.06],srm:[2,40],ibu:[0,120],abv:[0,14],carb:[2.1,2.9]}},"Sour Ale":{"Berliner Weisse":{gu:[1.028,1.032],fg:[1.003,1.006],srm:[2,3],ibu:[3,8],abv:[2.8,3.8],carb:[2.4,2.9]},"Flanders Red Ale":{gu:[1.048,1.057],fg:[1.002,1.012],srm:[10,16],ibu:[10,25],abv:[4.6,6.5],carb:[2.2,2.7]},"Flanders Brown Ale / Oud Bruin":{gu:[1.04,1.074],fg:[1.008,1.012],srm:[15,22],ibu:[20,25],abv:[4,8],carb:[2.2,2.8]},"Straight (Unblended) Lambic":{gu:[1.04,1.054],fg:[1.001,1.01],srm:[3,7],ibu:[0,10],abv:[5,6.5],carb:[1.8,2.6]},Gueuze:{gu:[1.04,1.06],fg:[1,1.006],srm:[3,7],ibu:[0,10],abv:[5,8],carb:[2.4,3.1]},"Fruit Lambic":{gu:[1.04,1.06],fg:[1,1.01],srm:[3,7],ibu:[0,10],abv:[5,7],carb:[2.4,3.1]}},"Belgian Strong Ale":{"Belgian Blond Ale":{gu:[1.062,1.075],fg:[1.008,1.018],srm:[4,7],ibu:[15,30],abv:[6,7.5],carb:[2.2,2.8]},"Belgian Dubbel":{gu:[1.062,1.075],fg:[1.008,1.018],srm:[10,17],ibu:[15,25],abv:[6,7.6],carb:[2.3,2.9]},"Belgian Tripel":{gu:[1.075,1.085],fg:[1.008,1.014],srm:[4.5,7],ibu:[20,40],abv:[7.5,9.5],carb:[2.4,3]},"Belgian Golden Strong Ale":{gu:[1.07,1.095],fg:[1.005,1.016],srm:[3,6],ibu:[22,35],abv:[7.5,10.5],carb:[2.3,2.9]},"Belgian Dark Strong Ale":{gu:[1.075,1.11],fg:[1.01,1.024],srm:[12,22],ibu:[20,35],abv:[8,11],carb:[2.3,2.9]}},"Strong Ale":{"Old Ale":{gu:[1.06,1.09],fg:[1.015,1.022],srm:[10,22],ibu:[30,60],abv:[6,9],carb:[1.8,2.5]},"English Barleywine":{gu:[1.08,1.12],fg:[1.018,1.03],srm:[8,22],ibu:[35,70],abv:[8,12],carb:[1.6,2.5]},"American Barleywine":{gu:[1.08,1.12],fg:[1.016,1.03],srm:[10,19],ibu:[50,120],abv:[8,12],carb:[1.8,2.5]}},"Fruit Beer":{"Fruit Beer":{gu:[1,1.12],fg:[1,1.16],srm:[1,40],ibu:[0,120],abv:[0,14],carb:[1,4]}},"Spice / Herb / Vegetable Beer":{"Spice, Herb, or Vegetable Beer":{gu:[1,1.12],fg:[1,1.16],srm:[1,40],ibu:[0,120],abv:[0,14],carb:[1,4]},"Christmas / Winter Specialty Spiced Beer":{gu:[1,1.12],fg:[1,1.16],srm:[8,40],ibu:[0,120],abv:[6,14],carb:[1,4]}},"Smoke-Flavored and Wood-Aged Beer":{"Classic Rauchbier":{gu:[1.05,1.056],fg:[1.012,1.016],srm:[14,22],ibu:[20,30],abv:[4.8,6],carb:[1,4]},"Other Smoked Beer":{gu:[1,1.12],fg:[1,1.16],srm:[1,40],ibu:[0,120],abv:[0,14],carb:[1,4]},"Wood-Aged Beer":{gu:[1,1.12],fg:[1,1.16],srm:[1,40],ibu:[0,120],abv:[0,14],carb:[1,4]}},"Specialty Beer":{"Specialty Beer":{gu:[1,1.12],fg:[1,1.16],srm:[1,40],ibu:[0,120],abv:[0,14],carb:[1,4]}}};_ref1=Brauhaus.STYLES;for(categoryName in _ref1){if(!__hasProp.call(_ref1,categoryName))continue;categoryStyles=_ref1[categoryName];for(styleName in categoryStyles){if(!__hasProp.call(categoryStyles,styleName))continue;style=categoryStyles[styleName];style.name=styleName;style.category=categoryName}}Brauhaus.getStyleCategories=function(){var categories,key,value,_ref2;categories=[];_ref2=Brauhaus.STYLES;for(key in _ref2){if(!__hasProp.call(_ref2,key))continue;value=_ref2[key];categories.push(key)}return categories};Brauhaus.getStyles=function(category){var key,styles,value,_ref2;styles=[];_ref2=Brauhaus.STYLES[category];for(key in _ref2){if(!__hasProp.call(_ref2,key))continue;value=_ref2[key];styles.push(key)}return styles};Brauhaus.getStyle=function(category,name){return Brauhaus.STYLES[category][name]};Brauhaus.parseDuration=function(value){var days,duration,factor,factors,hours,min,sec,unit,weeks,_i,_len,_ref2;duration=0;if(!isNaN(value)){return value}weeks=value.match(/(\d+)\s*w/i);days=value.match(/(\d+)\s*d/i);hours=value.match(/(\d+)\s*h/i);min=value.match(/(\d+)\s*m/i);sec=value.match(/(\d+)\s*s/i);factors=[[weeks,7*60*24],[days,60*24],[hours,60],[min,1],[sec,1/60]];for(_i=0,_len=factors.length;_i<_len;_i++){_ref2=factors[_i],unit=_ref2[0],factor=_ref2[1];if(unit){duration+=parseInt(unit[1])*factor}}return duration};Brauhaus.displayDuration=function(minutes,approximate){var amount,count,durations,factor,factors,label,_i,_len,_ref2,_ref3;durations=[];factors=[["month",30*60*24],["week",7*60*24],["day",60*24],["hour",60],["minute",1]];count=0;for(_i=0,_len=factors.length;_i<_len;_i++){_ref2=factors[_i],label=_ref2[0],factor=_ref2[1];if(factor===1||approximate!=null&&count===approximate-1){amount=Math.round(minutes/factor)}else{amount=Math.floor(minutes/factor)}minutes=minutes%factor;if(amount>0||count>0){count++}if(approximate!=null&&count>approximate){break}if(amount>0){durations.push(""+amount+" "+label+((_ref3=amount!==1?"s":void 0)!=null?_ref3:""))}}if(!durations.length){durations=["start"]}return durations.join(" ")};Brauhaus.kgToLb=function(kg){return kg*2.20462};Brauhaus.lbToKg=function(lb){return lb/2.20462};Brauhaus.kgToLbOz=function(kg){var lb;lb=Brauhaus.kgToLb(kg);return{lb:Math.floor(lb),oz:(lb-Math.floor(lb))*16}};Brauhaus.lbOzToKg=function(lb,oz){return Brauhaus.lbToKg(lb+oz/16)};Brauhaus.litersToGallons=function(liters){return liters*.264172};Brauhaus.gallonsToLiters=function(gallons){return gallons/.264172};Brauhaus.litersPerKgToQuartsPerLb=function(litersPerKg){return litersPerKg*.479305709};Brauhaus.quartsPerLbToLitersPerKg=function(quartsPerLb){return quartsPerLb/.479305709};Brauhaus.cToF=function(celcius){return celcius*1.8+32};Brauhaus.fToC=function(fahrenheit){return(fahrenheit-32)/1.8};Brauhaus.srmToEbc=function(srm){return srm*1.97};Brauhaus.ebcToSrm=function(ebc){return ebc*.508};Brauhaus.srmToLovibond=function(srm){return(srm+.76)/1.3546};Brauhaus.lovibondToSrm=function(lovibond){return 1.3546*lovibond-.76};Brauhaus.srmToRgb=function(srm){var b,g,r;r=Math.round(Math.min(255,Math.max(0,255*Math.pow(.975,srm))));g=Math.round(Math.min(255,Math.max(0,245*Math.pow(.88,srm))));b=Math.round(Math.min(255,Math.max(0,220*Math.pow(.7,srm))));return[r,g,b]};Brauhaus.srmToCss=function(srm){var b,g,r,_ref2;_ref2=Brauhaus.srmToRgb(srm),r=_ref2[0],g=_ref2[1],b=_ref2[2];return"rgb("+r+", "+g+", "+b+")"};Brauhaus.srmToName=function(srm){var color,item,_i,_len,_ref2;color=Brauhaus.COLOR_NAMES[0][1];_ref2=Brauhaus.COLOR_NAMES;for(_i=0,_len=_ref2.length;_i<_len;_i++){item=_ref2[_i];if(item[0]<=srm){color=item[1]}}return color};Brauhaus.timeToHeat=function(liters,degrees){var kj,minutes;if(degrees==null){degrees=80}kj=4.19*liters*degrees;return minutes=kj/Brauhaus.BURNER_ENERGY*60};Brauhaus.OptionConstructor=function(){function OptionConstructor(options){var property;for(property in options){if(!__hasProp.call(options,property))continue;this[property]=options[property]}}return OptionConstructor}();Brauhaus.Ingredient=function(_super){__extends(Ingredient,_super);function Ingredient(options){this.name="New "+this.constructor.name;Ingredient.__super__.constructor.call(this,options)}Ingredient.prototype.nameRegex=function(regex){var item,result,_i,_len;result=false;if(typeof regex==="string"){result=regex.exec(this.name)}else{for(_i=0,_len=regex.length;_i<_len;_i++){item=regex[_i];if(Array.isArray(item)&&item.length===2){if(item[0].exec(this.name)){result=item[1];break}}else if(typeof item==="string"){result=item.exec(this.name)}else{throw"Invalid regex input!"}}}return result};return Ingredient}(Brauhaus.OptionConstructor);Brauhaus.Fermentable=function(_super){__extends(Fermentable,_super);function Fermentable(){_ref2=Fermentable.__super__.constructor.apply(this,arguments);return _ref2}Fermentable.STEEP=/biscuit|black|cara|chocolate|crystal|munich|roast|special ?b|toast|victory|vienna/i;Fermentable.BOIL=/candi|candy|dme|dry|extract|honey|lme|liquid|sugar|syrup|turbinado/i;Fermentable.prototype.weight=1;Fermentable.prototype["yield"]=75;Fermentable.prototype.color=2;Fermentable.prototype.late=false;Fermentable.prototype.type=function(){return this.nameRegex([[Brauhaus.Fermentable.BOIL,"extract"],[/.*/,"grain"]])};Fermentable.prototype.addition=function(){return this.nameRegex([[/mash/i,"mash"],[/steep/i,"steep"],[/boil/i,"boil"],[Brauhaus.Fermentable.BOIL,"boil"],[Brauhaus.Fermentable.STEEP,"steep"],[/.*/,"mash"]])};Fermentable.prototype.weightLb=function(){return Brauhaus.kgToLb(this.weight)};Fermentable.prototype.weightLbOz=function(){return Brauhaus.kgToLbOz(this.weight)};Fermentable.prototype.ppg=function(){return this["yield"]*.46214};Fermentable.prototype.plato=function(liters){if(liters==null){liters=1}return 259-259/(1+this.gu(liters)/1e3)};Fermentable.prototype.gu=function(liters){if(liters==null){liters=1}return this.ppg()*this.weightLb()/Brauhaus.litersToGallons(liters)};Fermentable.prototype.colorRgb=function(){return Brauhaus.srmToRgb(this.color)};Fermentable.prototype.colorCss=function(){return Brauhaus.srmToCss(this.color)};Fermentable.prototype.colorName=function(){return Brauhaus.srmToName(this.color)};Fermentable.prototype.price=function(){var pricePerKg;pricePerKg=this.nameRegex([[/dry|dme/i,8.8],[/liquid|lme/i,6.6],[/.*/i,4.4]]);return this.weight*pricePerKg};return Fermentable}(Brauhaus.Ingredient);Brauhaus.Spice=function(_super){__extends(Spice,_super);function Spice(){_ref3=Spice.__super__.constructor.apply(this,arguments);return _ref3}Spice.DRY_SPICE=/primary|secondary|dry/i;Spice.prototype.weight=.025;Spice.prototype.aa=0;Spice.prototype.use="boil";Spice.prototype.time=60;Spice.prototype.form="pellet";Spice.prototype.dry=function(){return Brauhaus.Spice.DRY_SPICE.exec(this.use)||false};Spice.prototype.weightLb=function(){return Brauhaus.kgToLb(this.weight)};Spice.prototype.weightLbOz=function(){return Brauhaus.kgToLbOz(this.weight)};Spice.prototype.price=function(){var pricePerKg;pricePerKg=this.nameRegex([[/.*/i,17.64]]);return this.weight*pricePerKg};return Spice}(Brauhaus.Ingredient);Brauhaus.Yeast=function(_super){__extends(Yeast,_super);function Yeast(){_ref4=Yeast.__super__.constructor.apply(this,arguments);return _ref4}Yeast.prototype.type="ale";Yeast.prototype.form="liquid";Yeast.prototype.attenuation=75;Yeast.prototype.price=function(){return this.nameRegex([[/wyeast|white labs|wlp/i,7],[/.*/i,3.5]])};return Yeast}(Brauhaus.Ingredient);Brauhaus.MashStep=function(_super){__extends(MashStep,_super);function MashStep(){_ref5=MashStep.__super__.constructor.apply(this,arguments);return _ref5}MashStep.types=["Infusion","Temperature","Decoction"];MashStep.prototype.name="Saccharification";MashStep.prototype.type="Infusion";MashStep.prototype.waterRatio=3;MashStep.prototype.temp=68;MashStep.prototype.endTemp=null;MashStep.prototype.time=60;MashStep.prototype.rampTime=null;MashStep.prototype.description=function(siUnits,totalGrainWeight){var absoluteUnits,desc,relativeUnits,temp,waterAmount,waterRatio;if(siUnits==null){siUnits=true}desc="";if(siUnits){absoluteUnits="l";relativeUnits="l per kg";temp=""+this.temp+"C";waterRatio=this.waterRatio}else{absoluteUnits="qt";relativeUnits="qt per lb";temp=""+this.tempF()+"F";waterRatio=this.waterRatioQtPerLb()}if(totalGrainWeight!=null){if(!siUnits){totalGrainWeight=Brauhaus.kgToLb(totalGrainWeight)}waterAmount=""+(waterRatio*totalGrainWeight).toFixed(1)+absoluteUnits}else{waterAmount=""+waterRatio.toFixed(1)+relativeUnits+" of grain"}switch(this.type){case"Infusion":desc="Infuse "+waterAmount+" for "+this.time+" minutes at "+temp;break;case"Temperature":desc="Stop heating and hold for "+this.time+" minutes at "+temp;break;case"Decoction":desc="Add "+waterAmount+" boiled water to reach "+temp+" and hold for "+this.time+" minutes";break;default:desc="Unknown mash step type '"+this.type+"'!"}return desc};MashStep.prototype.waterRatioQtPerLb=function(){return Brauhaus.litersPerKgToQuartsPerLb(this.waterRatio)};MashStep.prototype.tempF=function(){return Brauhaus.cToF(this.temp)};MashStep.prototype.endTempF=function(){return Brauhaus.cToF(this.endTemp)};return MashStep}(Brauhaus.OptionConstructor);Brauhaus.Mash=function(_super){var ph;__extends(Mash,_super);function Mash(options){this.steps=[];Mash.__super__.constructor.call(this,options)}Mash.prototype.name="";Mash.prototype.grainTemp=Brauhaus.ROOM_TEMP;Mash.prototype.spargeTemp=76;ph=null;Mash.prototype.notes="";Mash.prototype.steps=null;Mash.prototype.grainTempF=function(){return Brauhaus.cToF(this.grainTemp)};Mash.prototype.spargeTempF=function(){return Brauhaus.cToF(this.spargeTemp)};Mash.prototype.addStep=function(options){return this.steps.push(new Brauhaus.MashStep(options))};return Mash}(Brauhaus.OptionConstructor);Brauhaus.Recipe=function(_super){__extends(Recipe,_super);Recipe.prototype.name="New Recipe";Recipe.prototype.description="Recipe description";Recipe.prototype.author="Anonymous Brewer";Recipe.prototype.boilSize=10;Recipe.prototype.batchSize=20;Recipe.prototype.servingSize=.355;Recipe.prototype.steepEfficiency=50;Recipe.prototype.steepTime=20;Recipe.prototype.mashEfficiency=75;Recipe.prototype.style=null;Recipe.prototype.ibuMethod="tinseth";Recipe.prototype.fermentables=null;Recipe.prototype.spices=null;Recipe.prototype.yeast=null;Recipe.prototype.mash=null;Recipe.prototype.og=0;Recipe.prototype.fg=0;Recipe.prototype.color=0;Recipe.prototype.ibu=0;Recipe.prototype.abv=0;Recipe.prototype.price=0;Recipe.prototype.buToGu=0;Recipe.prototype.bv=0;Recipe.prototype.ogPlato=0;Recipe.prototype.fgPlato=0;Recipe.prototype.abw=0;Recipe.prototype.realExtract=0;Recipe.prototype.calories=0;Recipe.prototype.bottlingTemp=0;Recipe.prototype.bottlingPressure=0;Recipe.prototype.primaryDays=14;Recipe.prototype.primaryTemp=20;Recipe.prototype.secondaryDays=0;Recipe.prototype.secondaryTemp=0;Recipe.prototype.tertiaryDays=0;Recipe.prototype.tertiaryTemp=0;Recipe.prototype.agingDays=14;Recipe.prototype.agingTemp=20;Recipe.prototype.brewDayDuration=null;Recipe.prototype.timelineMap=null;Recipe.fromBeerXml=function(xml){var doc,fermentable,fermentableNode,fermentableProperty,mash,mashProperty,parser,recipe,recipeNode,recipeProperty,recipes,spice,spiceNode,spiceProperty,step,stepNode,stepProperty,styleNode,yeast,yeastNode,yeastProperty,_i,_j,_k,_l,_len,_len1,_len10,_len11,_len2,_len3,_len4,_len5,_len6,_len7,_len8,_len9,_m,_n,_o,_p,_q,_r,_ref10,_ref11,_ref12,_ref13,_ref14,_ref15,_ref16,_ref17,_ref18,_ref6,_ref7,_ref8,_ref9,_s,_t;recipes=[];parser=new DOMParser;doc=parser.parseFromString(xml,"text/xml");_ref6=doc.documentElement.childNodes||[];for(_i=0,_len=_ref6.length;_i<_len;_i++){recipeNode=_ref6[_i];if(recipeNode.nodeName.toLowerCase()!=="recipe"){continue}recipe=new Brauhaus.Recipe;_ref7=recipeNode.childNodes||[];for(_j=0,_len1=_ref7.length;_j<_len1;_j++){recipeProperty=_ref7[_j];switch(recipeProperty.nodeName.toLowerCase()){case"name":recipe.name=recipeProperty.textContent;break;case"brewer":recipe.author=recipeProperty.textContent;break;case"batch_size":recipe.batchSize=parseFloat(recipeProperty.textContent);break;case"boil_size":recipe.boilSize=parseFloat(recipeProperty.textContent);break;case"efficiency":recipe.mashEfficiency=parseFloat(recipeProperty.textContent);break;case"primary_age":recipe.primaryDays=parseFloat(recipeProperty.textContent);break;case"primary_temp":recipe.primaryTemp=parseFloat(recipeProperty.textContent);break;case"secondary_age":recipe.secondaryDays=parseFloat(recipeProperty.textContent);break;case"secondary_temp":recipe.secondaryTemp=parseFloat(recipeProperty.textContent);break;case"tertiary_age":recipe.tertiaryDays=parseFloat(recipeProperty.textContent);break;case"tertiary_temp":recipe.tertiaryTemp=parseFloat(recipeProperty.textContent);break;case"carbonation":recipe.bottlingPressure=parseFloat(recipeProperty.textContent);break;case"carbonation_temp":recipe.bottlingTemp=parseFloat(recipeProperty.textContent);break;case"age":recipe.agingDays=parseFloat(recipeProperty.textContent);break;case"age_temp":recipe.agingTemp=parseFloat(recipeProperty.textContent);break;case"style":recipe.style={og:[1,1.15],fg:[1,1.15],ibu:[0,150],color:[0,500],abv:[0,14],carb:[1,4]};_ref8=recipeProperty.childNodes||[];for(_k=0,_len2=_ref8.length;_k<_len2;_k++){styleNode=_ref8[_k];switch(styleNode.nodeName.toLowerCase()){case"name":recipe.style.name=styleNode.textContent;break;case"category":recipe.style.category=styleNode.textContent;break;case"og_min":recipe.style.og[0]=parseFloat(styleNode.textContent);break;case"og_max":recipe.style.og[1]=parseFloat(styleNode.textContent);break;case"fg_min":recipe.style.fg[0]=parseFloat(styleNode.textContent);break;case"fg_max":recipe.style.fg[1]=parseFloat(styleNode.textContent);break;case"ibu_min":recipe.style.ibu[0]=parseFloat(styleNode.textContent);break;case"ibu_max":recipe.style.ibu[1]=parseFloat(styleNode.textContent);break;case"color_min":recipe.style.color[0]=parseFloat(styleNode.textContent);break;case"color_max":recipe.style.color[1]=parseFloat(styleNode.textContent);break;case"abv_min":recipe.style.abv[0]=parseFloat(styleNode.textContent);break;case"abv_max":recipe.style.abv[1]=parseFloat(styleNode.textContent);break;case"carb_min":recipe.style.carb[0]=parseFloat(styleNode.textContent);break;case"carb_max":recipe.style.carb[1]=parseFloat(styleNode.textContent)}}break;case"fermentables":_ref9=recipeProperty.childNodes||[];for(_l=0,_len3=_ref9.length;_l<_len3;_l++){fermentableNode=_ref9[_l];if(fermentableNode.nodeName.toLowerCase()!=="fermentable"){continue}fermentable=new Brauhaus.Fermentable;_ref10=fermentableNode.childNodes||[];for(_m=0,_len4=_ref10.length;_m<_len4;_m++){fermentableProperty=_ref10[_m];switch(fermentableProperty.nodeName.toLowerCase()){case"name":fermentable.name=fermentableProperty.textContent;break;case"amount":fermentable.weight=parseFloat(fermentableProperty.textContent);break;case"yield":fermentable["yield"]=parseFloat(fermentableProperty.textContent);break;case"color":fermentable.color=parseFloat(fermentableProperty.textContent);break;case"add_after_boil":fermentable.late=fermentableProperty.textContent.toLowerCase()==="true"}}recipe.fermentables.push(fermentable)}break;case"hops":case"miscs":_ref11=recipeProperty.childNodes||[];for(_n=0,_len5=_ref11.length;_n<_len5;_n++){spiceNode=_ref11[_n];if((_ref12=spiceNode.nodeName.toLowerCase())!=="hop"&&_ref12!=="misc"){continue}spice=new Brauhaus.Spice;_ref13=spiceNode.childNodes||[];for(_o=0,_len6=_ref13.length;_o<_len6;_o++){spiceProperty=_ref13[_o];switch(spiceProperty.nodeName.toLowerCase()){case"name":spice.name=spiceProperty.textContent;break;case"amount":spice.weight=parseFloat(spiceProperty.textContent);break;case"alpha":spice.aa=parseFloat(spiceProperty.textContent);break;case"use":spice.use=spiceProperty.textContent;break;case"form":spice.form=spiceProperty.textContent}}recipe.spices.push(spice)}break;case"yeasts":_ref14=recipeProperty.childNodes||[];for(_p=0,_len7=_ref14.length;_p<_len7;_p++){yeastNode=_ref14[_p];if(yeastNode.nodeName.toLowerCase()!=="yeast"){continue}yeast=new Brauhaus.Yeast;_ref15=yeastNode.childNodes||[];for(_q=0,_len8=_ref15.length;_q<_len8;_q++){yeastProperty=_ref15[_q];switch(yeastProperty.nodeName.toLowerCase()){case"name":yeast.name=yeastProperty.textContent;break;case"type":yeast.type=yeastProperty.textContent;break;case"form":yeast.form=yeastProperty.textContent;break;case"attenuation":yeast.attenuation=parseFloat(yeastProperty.textContent)}}recipe.yeast.push(yeast)}break;case"mash":mash=recipe.mash=new Brauhaus.Mash;_ref16=recipeProperty.childNodes||[];for(_r=0,_len9=_ref16.length;_r<_len9;_r++){mashProperty=_ref16[_r];switch(mashProperty.nodeName.toLowerCase()){case"name":mash.name=mashProperty.textContent;break;case"grain_temp":mash.grainTemp=parseFloat(mashProperty.textContent);break;case"sparge_temp":mash.spargeTemp=parseFloat(mashProperty.textContent);break;case"ph":mash.ph=parseFloat(mashProperty.textContent);break;case"notes":mash.notes=mashProperty.textContent;break;case"mash_steps":_ref17=mashProperty.childNodes||[];for(_s=0,_len10=_ref17.length;_s<_len10;_s++){stepNode=_ref17[_s];if(stepNode.nodeName.toLowerCase()!=="mash_step"){continue}step=new Brauhaus.MashStep;_ref18=stepNode.childNodes||[];for(_t=0,_len11=_ref18.length;_t<_len11;_t++){stepProperty=_ref18[_t];switch(stepProperty.nodeName.toLowerCase()){case"name":step.name=stepProperty.textContent;break;case"type":step.type=stepProperty.textContent;break;case"infuse_amount":step.waterRatio=parseFloat(stepProperty.textContent)/recipe.grainWeight();break;case"step_temp":step.temp=parseFloat(stepProperty.textContent);break;case"end_temp":step.endTemp=parseFloat(stepProperty.textContent);break;case"step_time":step.time=parseFloat(stepProperty.textContent);break;case"decoction_amt":step.waterRatio=parseFloat(stepProperty.textContent)/recipe.grainWeight()}}mash.steps.push(step)}}}}}recipes.push(recipe)}return recipes};function Recipe(options){this.fermentables=[];this.spices=[];this.yeast=[];Recipe.__super__.constructor.call(this,options)}Recipe.prototype.batchSizeGallons=function(){return Brauhaus.litersToGallons(this.batchSize)};Recipe.prototype.boilSizeGallons=function(){return Brauhaus.litersToGallons(this.boilSize)};Recipe.prototype.add=function(type,values){switch(type){case"fermentable":return this.fermentables.push(new Brauhaus.Fermentable(values));case"spice":case"hop":return this.spices.push(new Brauhaus.Spice(values));case"yeast":return this.yeast.push(new Brauhaus.Yeast(values))}};Recipe.prototype.grainWeight=function(){var fermentable,weight,_i,_len,_ref6;weight=0;_ref6=this.fermentables;for(_i=0,_len=_ref6.length;_i<_len;_i++){fermentable=_ref6[_i];if(fermentable.type()==="grain"){weight+=fermentable.weight}}return weight};Recipe.prototype.bottleCount=function(){return Math.floor(this.batchSize/this.servingSize)};Recipe.prototype.calculate=function(){var addition,adjustment,attenuation,bitterness,earlyOg,efficiency,fermentable,gravity,gu,mcu,rte,spice,time,utilization,utilizationFactor,yeast,_base,_base1,_i,_j,_k,_len,_len1,_len2,_ref10,_ref6,_ref7,_ref8,_ref9;this.og=1;this.fg=0;this.ibu=0;this.price=0;earlyOg=1;mcu=0;attenuation=0;this.timelineMap={fermentables:{mash:[],steep:[],boil:[],boilEnd:[]},times:{},drySpice:{},yeast:[]};_ref6=this.fermentables;for(_i=0,_len=_ref6.length;_i<_len;_i++){fermentable=_ref6[_i];efficiency=1;addition=fermentable.addition();if(addition==="steep"){efficiency=this.steepEfficiency/100}else if(addition==="mash"){efficiency=this.mashEfficiency/100}mcu+=fermentable.color*fermentable.weightLb()/this.batchSizeGallons();gu=fermentable.gu(this.batchSize)*efficiency;gravity=gu/1e3;this.og+=gravity;if(!fermentable.late){earlyOg+=gravity}this.price+=fermentable.price();switch(addition){case"boil":if(!fermentable.late){this.timelineMap.fermentables.boil.push([fermentable,gu])}else{this.timelineMap.fermentables.boilEnd.push([fermentable,gu])}break;case"steep":this.timelineMap.fermentables.steep.push([fermentable,gu]);break;case"mash":this.timelineMap.fermentables.mash.push([fermentable,gu])}}this.color=1.4922*Math.pow(mcu,.6859);_ref7=this.yeast;for(_j=0,_len1=_ref7.length;_j<_len1;_j++){yeast=_ref7[_j];if(yeast.attenuation>attenuation){attenuation=yeast.attenuation}this.price+=yeast.price();this.timelineMap.yeast.push(yeast)}if(attenuation===0){attenuation=75}this.fg=this.og-(this.og-1)*attenuation/100;this.abv=1.05*(this.og-this.fg)/this.fg/.79*100;this.ogPlato=-463.37+668.72*this.og-205.35*this.og*this.og;this.fgPlato=-463.37+668.72*this.fg-205.35*this.fg*this.fg;this.realExtract=.1808*this.ogPlato+.8192*this.fgPlato;this.abw=.79*this.abv/this.fg;this.calories=Math.max(0,(6.9*this.abw+4*(this.realExtract-.1))*this.fg*this.servingSize*10);_ref8=this.spices;for(_k=0,_len2=_ref8.length;_k<_len2;_k++){spice=_ref8[_k];bitterness=0;time=spice.time;if(spice.aa&&spice.use.toLowerCase()==="boil"){utilizationFactor=1;if(spice.form==="pellet"){utilizationFactor=1.15}if(this.ibuMethod==="tinseth"){bitterness=1.65*Math.pow(125e-6,earlyOg-1)*((1-Math.pow(Math.E,-.04*spice.time))/4.15)*(spice.aa/100*spice.weight*1e6/this.batchSize)*utilizationFactor;this.ibu+=bitterness}else if(this.ibuMethod==="rager"){utilization=18.11+13.86*tanh((spice.time-31.32)/18.27);adjustment=Math.max(0,(earlyOg-1.05)/.2);bitterness=spice.weight*100*utilization*utilizationFactor*spice.aa/(this.batchSize*(1+adjustment));this.ibu+=bitterness}else{throw"Unknown IBU method '"+this.ibuMethod+"'!"}}this.price+=spice.price();if(spice.dry()){if((_ref9=(_base=this.timelineMap["drySpice"])[time])==null){_base[time]=[]}this.timelineMap["drySpice"][time].push([spice,bitterness])}else{if((_ref10=(_base1=this.timelineMap["times"])[time])==null){_base1[time]=[]}this.timelineMap["times"][time].push([spice,bitterness])}}this.buToGu=this.ibu/(this.og-1)/1e3;rte=(.82*(this.fg-1)+.18*(this.og-1))*1e3;return this.bv=.8*this.ibu/rte};Recipe.prototype.timeline=function(siUnits){var action,ageTemp,boilName,boilTime,boilVolume,chillTemp,currentTemp,fermentable,fermentableList,gravity,heatTemp,i,ingredients,key,liquidVolume,mash,previousSpiceTime,primeMsg,spiceList,steepHeatTime,steepTemp,steepVolume,steepWeight,step,steps,strikeTemp,strikeTempDesc,strikeVolume,strikeVolumeDesc,time,timeToHeat,timeline,times,timesStart,totalTime,value,waterChangeRatio,yeast,yeasts,_i,_j,_len,_len1,_ref6;
if(siUnits==null){siUnits=true}timeline=[];boilName="water";totalTime=0;currentTemp=Brauhaus.ROOM_TEMP;liquidVolume=0;fermentableList=function(items){var fermentable,gravity,ingredients,lboz,weight,_i,_len,_ref6,_ref7;ingredients=[];_ref6=items||[];for(_i=0,_len=_ref6.length;_i<_len;_i++){_ref7=_ref6[_i],fermentable=_ref7[0],gravity=_ref7[1];if(siUnits){weight=""+fermentable.weight.toFixed(1)+"kg"}else{lboz=fermentable.weightLbOz();weight=""+parseInt(lboz.lb)+"lb "+parseInt(lboz.oz)+"oz"}ingredients.push(""+weight+" of "+fermentable.name+" ("+gravity.toFixed(1)+" GU)")}return ingredients};spiceList=function(items){var extra,ibu,ingredients,spice,weight,_i,_len,_ref6,_ref7;ingredients=[];_ref6=items||[];for(_i=0,_len=_ref6.length;_i<_len;_i++){_ref7=_ref6[_i],spice=_ref7[0],ibu=_ref7[1];if(siUnits){weight=""+parseInt(spice.weight*1e3)+"g"}else{weight=""+(spice.weightLb()*16).toFixed(2)+"oz"}extra="";if(ibu){extra=" ("+ibu.toFixed(1)+" IBU)"}ingredients.push(""+weight+" of "+spice.name+extra)}return ingredients};if(this.timelineMap.fermentables.mash.length){boilName="wort";mash=this.mash;if(mash==null){mash=new Brauhaus.Mash}ingredients=fermentableList(this.timelineMap.fermentables.mash);timeline.push([totalTime,"Begin "+mash.name+" mash. Add "+ingredients.join(", ")+"."]);steps=this.mash.steps||[new Brauhaus.MashStep({name:"Saccharification",type:"Infusion",time:60,rampTime:Brauhaus.timeToHeat(this.grainWeight(),68-currentTemp),temp:68,waterRatio:2.75})];for(_i=0,_len=steps.length;_i<_len;_i++){step=steps[_i];strikeVolume=step.waterRatio*this.grainWeight()-liquidVolume;if(step.temp!==currentTemp&&strikeVolume>0){strikeTemp=(step.temp-currentTemp)*.4184*this.grainWeight()/strikeVolume+step.temp;timeToHeat=Brauhaus.timeToHeat(strikeVolume,strikeTemp-currentTemp);if(siUnits){strikeVolumeDesc=""+strikeVolume.toFixed(1)+"l";strikeTempDesc=""+Math.round(strikeTemp)+"°C"}else{strikeVolumeDesc=""+(Brauhaus.litersToGallons(strikeVolume)*4).toFixed(1)+"qts";strikeTempDesc=""+Math.round(Brauhaus.cToF(strikeTemp))+"°F"}timeline.push([totalTime,"Heat "+strikeVolumeDesc+" to "+strikeTempDesc+" (about "+Math.round(timeToHeat)+" minutes)"]);liquidVolume+=strikeVolume;totalTime+=timeToHeat}else if(step.temp!==currentTemp){timeToHeat=Brauhaus.timeToHeat(liquidVolume,step.temp-currentTemp);if(siUnits){heatTemp=""+Math.round(step.temp)+"°C"}else{heatTemp=""+Math.round(Brauhaus.cToF(step.temp))+"°F"}timeline.push([totalTime,"Heat the mash to "+heatTemp+" (about "+Math.round(timeToHeat)+" minutes)"]);totalTime+=timeToHeat}timeline.push([totalTime,""+step.name+": "+step.description(siUnits,this.grainWeight())+"."]);totalTime+=step.time;currentTemp=step.temp-step.time*Brauhaus.MASH_HEAT_LOSS/60}timeline.push([totalTime,"Remove grains from mash. This is now your wort."]);totalTime+=5}if(this.timelineMap.fermentables.steep.length){boilName="wort";steepWeight=function(){var _j,_len1,_ref6,_ref7,_results;_ref6=this.timelineMap.fermentables.steep;_results=[];for(_j=0,_len1=_ref6.length;_j<_len1;_j++){_ref7=_ref6[_j],fermentable=_ref7[0],gravity=_ref7[1];_results.push(fermentable.weight)}return _results}.call(this).reduce(function(x,y){return x+y});steepHeatTime=Brauhaus.timeToHeat(steepWeight*2.75,68-currentTemp);currentTemp=68;liquidVolume+=steepWeight*2.75;if(siUnits){steepVolume=""+(steepWeight*2.75).toFixed(1)+"l";steepTemp=""+68+"°C"}else{steepVolume=""+Brauhaus.litersToGallons(steepWeight*2.75).toFixed(1)+"gal";steepTemp=""+Brauhaus.cToF(68).toFixed(1)+"°F"}timeline.push([totalTime,"Heat "+steepVolume+" to "+steepTemp+" (about "+Math.round(steepHeatTime)+" minutes)"]);totalTime+=steepHeatTime;ingredients=fermentableList(this.timelineMap.fermentables.steep);timeline.push([totalTime,"Add "+ingredients.join(", ")+" and steep for "+this.steepTime+" minutes."]);totalTime+=20}waterChangeRatio=Math.min(1,liquidVolume/this.boilSize);currentTemp=currentTemp*waterChangeRatio+Brauhaus.ROOM_TEMP*(1-waterChangeRatio);if(siUnits){boilVolume=""+this.boilSize.toFixed(1)+"l"}else{boilVolume=""+this.boilSizeGallons().toFixed(1)+"gal"}if(this.boilSize-liquidVolume<this.boilSize){action="Top up the "+boilName+" to "+boilVolume+" and heat to a rolling boil"}else{action="Bring "+boilVolume+" to a rolling boil"}boilTime=parseInt(Brauhaus.timeToHeat(this.boilSize,100-currentTemp));timeline.push([totalTime,""+action+" (about "+boilTime+" minutes)."]);totalTime+=boilTime;timesStart=totalTime;times=function(){var _ref6,_results;_ref6=this.timelineMap.times;_results=[];for(key in _ref6){if(!__hasProp.call(_ref6,key))continue;value=_ref6[key];_results.push(parseInt(key))}return _results}.call(this);if(this.timelineMap.fermentables.boilEnd.length&&__indexOf.call(times,5)<0){this.timelineMap.times[5]=[];times.push(5)}previousSpiceTime=0;_ref6=times.sort(function(x,y){return y-x});for(i=_j=0,_len1=_ref6.length;_j<_len1;i=++_j){time=_ref6[i];ingredients=spiceList(this.timelineMap.times[time]);if(i===0){ingredients=fermentableList(this.timelineMap.fermentables.boil).concat(ingredients);previousSpiceTime=time}totalTime+=previousSpiceTime-time;previousSpiceTime=time;if(time===5&&this.timelineMap.fermentables.boilEnd.length){ingredients=fermentableList(this.timelineMap.fermentables.boilEnd).concat(ingredients)}timeline.push([totalTime,"Add "+ingredients.join(", ")])}totalTime+=previousSpiceTime;if(siUnits){chillTemp=""+this.primaryTemp+"°C"}else{chillTemp=""+Brauhaus.cToF(this.primaryTemp)+"°F"}timeline.push([totalTime,"Flame out. Begin chilling to "+chillTemp+" and aerate the cooled wort (about 20 minutes)."]);totalTime+=20;yeasts=function(){var _k,_len2,_ref7,_results;_ref7=this.yeast;_results=[];for(_k=0,_len2=_ref7.length;_k<_len2;_k++){yeast=_ref7[_k];_results.push(yeast.name)}return _results}.call(this);if(!yeasts.length&&this.primaryDays){yeasts=["yeast"]}if(yeasts.length){timeline.push([totalTime,"Pitch "+yeasts.join(", ")+" and seal the fermenter. You should see bubbles in the airlock within 24 hours."])}this.brewDayDuration=totalTime;if(!this.primaryDays&&!this.secondaryDays&&!this.tertiaryDays){timeline.push([totalTime,"Drink immediately (about "+this.bottleCount()+" bottles)."]);return timeline}totalTime+=this.primaryDays*1440;if(this.secondaryDays){timeline.push([totalTime,"Move to secondary fermenter for "+Brauhaus.displayDuration(this.secondaryDays*1440,2)+"."]);totalTime+=this.secondaryDays*1440}else if(this.tertiaryDays){timeline.push([totalTime,"Move to tertiary fermenter for "+Brauhaus.displayDuration(this.tertiaryDays*1440,2)+"."]);totalTime+=this.tertiaryDays*1440}primeMsg="Prime and bottle about "+this.bottleCount()+" bottles.";if(this.agingDays){if(siUnits){ageTemp=""+this.agingTemp+"C"}else{ageTemp=""+Brauhaus.cToF(this.agingTemp)+"F"}primeMsg+=" Age at "+ageTemp+" for "+this.agingDays+" days."}timeline.push([totalTime,primeMsg]);totalTime+=this.agingDays*1440;timeline.push([totalTime,"Relax, don't worry and have a homebrew!"]);return timeline};Recipe.prototype.toBeerXml=function(){var fermentable,hop,misc,step,xml,yeast,_i,_j,_k,_l,_len,_len1,_len2,_len3,_len4,_m,_ref10,_ref6,_ref7,_ref8,_ref9;xml='<?xml version="1.0" encoding="utf-8"?><recipes><recipe>';xml+="<version>1</version>";xml+="<name>"+this.name+"</name>";xml+="<brewer>"+this.author+"</brewer>";xml+="<batch_size>"+this.batchSize+"</batch_size>";xml+="<boil_size>"+this.boilSize+"</boil_size>";xml+="<efficiency>"+this.mashEfficiency+"</efficiency>";if(this.primaryDays){xml+="<primary_age>"+this.primaryDays+"</primary_age>"}if(this.primaryTemp){xml+="<primary_temp>"+this.primaryTemp+"</primary_temp>"}if(this.secondaryDays){xml+="<secondary_age>"+this.secondaryDays+"</secondary_age>"}if(this.secondaryTemp){xml+="<secondary_temp>"+this.secondaryTemp+"</secondary_temp>"}if(this.tertiaryDays){xml+="<tertiary_age>"+this.tertiaryDays+"</tertiary_age>"}if(this.tertiaryTemp){xml+="<tertiary_temp>"+this.tertiaryTemp+"</tertiary_temp>"}if(this.agingDays){xml+="<age>"+this.agingDays+"</age>"}if(this.agingTemp){xml+="<age_temp>"+this.agingTemp+"</age_temp>"}if(this.bottlingTemp){xml+="<carbonation_temp>"+this.bottlingTemp+"</carbonation_temp>"}if(this.bottlingPressure){xml+="<carbonation>"+this.bottlingPressure+"</carbonation>"}if(this.style){xml+="<style><version>1</version>";if(this.style.name){xml+="<name>"+this.style.name+"</name>"}if(this.style.category){xml+="<category>"+this.style.category+"</category>"}xml+="<og_min>"+this.style.og[0]+"</og_min><og_max>"+this.style.og[1]+"</og_max>";xml+="<fg_min>"+this.style.fg[0]+"</fg_min><fg_max>"+this.style.fg[1]+"</fg_max>";xml+="<ibu_min>"+this.style.ibu[0]+"</ibu_min><ibu_max>"+this.style.ibu[1]+"</ibu_max>";xml+="<color_min>"+this.style.color[0]+"</color_min><color_max>"+this.style.color[1]+"</color_max>";xml+="<abv_min>"+this.style.abv[0]+"</abv_min><abv_max>"+this.style.abv[1]+"</abv_max>";xml+="<carb_min>"+this.style.carb[0]+"</carb_min><carb_max>"+this.style.carb[1]+"</carb_max>";xml+="</style>"}xml+="<fermentables>";_ref6=this.fermentables;for(_i=0,_len=_ref6.length;_i<_len;_i++){fermentable=_ref6[_i];xml+="<fermentable><version>1</version>";xml+="<name>"+fermentable.name+"</name>";xml+="<type>"+fermentable.type()+"</type>";xml+="<weight>"+fermentable.weight.toFixed(1)+"</weight>";xml+="<yield>"+fermentable["yield"].toFixed(1)+"</yield>";xml+="<color>"+fermentable.color.toFixed(1)+"</color>";xml+="</fermentable>"}xml+="</fermentables>";xml+="<hops>";_ref7=this.spices.filter(function(item){return item.aa>0});for(_j=0,_len1=_ref7.length;_j<_len1;_j++){hop=_ref7[_j];xml+="<hop><version>1</version>";xml+="<name>"+hop.name+"</name>";xml+="<time>"+hop.time+"</time>";xml+="<amount>"+hop.weight+"</amount>";xml+="<alpha>"+hop.aa.toFixed(2)+"</alpha>";xml+="<use>"+hop.use+"</use>";xml+="<form>"+hop.form+"</form>";xml+="</hop>"}xml+="</hops>";xml+="<yeasts>";_ref8=this.yeast;for(_k=0,_len2=_ref8.length;_k<_len2;_k++){yeast=_ref8[_k];xml+="<yeast><version>1</version>";xml+="<name>"+yeast.name+"</name>";xml+="<type>"+yeast.type+"</type>";xml+="<form>"+yeast.form+"</form>";xml+="<attenuation>"+yeast.attenuation+"</attenuation>";xml+="</yeast>"}xml+="</yeasts>";xml+="<miscs>";_ref9=this.spices.filter(function(item){return item.aa===0});for(_l=0,_len3=_ref9.length;_l<_len3;_l++){misc=_ref9[_l];xml+="<misc><version>1</version>";xml+="<name>"+misc.name+"</name>";xml+="<time>"+misc.time+"</time>";xml+="<amount>"+misc.weight+"</amount>";xml+="<use>"+misc.use+"</use>";xml+="</misc>"}xml+="</miscs>";if(this.mash){xml+="<mash><version>1</version>";xml+="<name>"+this.mash.name+"</name>";xml+="<grain_temp>"+this.mash.grainTemp+"</grain_temp>";xml+="<sparge_temp>"+this.mash.spargeTemp+"</sparge_temp>";xml+="<ph>"+this.mash.ph+"</ph>";xml+="<notes>"+this.mash.notes+"</notes>";xml+="<mash_steps>";_ref10=this.mash.steps;for(_m=0,_len4=_ref10.length;_m<_len4;_m++){step=_ref10[_m];xml+="<mash_step><version>1</version>";xml+="<name>"+step.name+"</name>";xml+="<description>"+step.description(true,this.grainWeight())+"</description>";xml+="<step_time>"+step.time+"</step_time>";xml+="<step_temp>"+step.temp+"</step_temp>";xml+="<end_temp>"+step.endTemp+"</end_temp>";xml+="<ramp_time>"+step.rampTime+"</ramp_time>";if(step.type==="Decoction"){xml+="<decoction_amt>"+step.waterRatio*this.grainWeight()+"</decoction_amt>"}else{xml+="<infuse_amount>"+step.waterRatio*this.grainWeight()+"</infuse_amount>"}xml+="</mash_step>"}xml+="</mash_steps>";xml+="</mash>"}return xml+="</recipe></recipes>"};return Recipe}(Brauhaus.OptionConstructor)}).call(this);